listeners:
  - id: "http-main"
    address: ":8080"
    protocol: "http"
    http:
      read_timeout: 30s
      write_timeout: 30s
      idle_timeout: 60s

# Service Registry Configuration
registry:
  type: "memory"  # consul, etcd, kubernetes, memory

  consul:
    address: "localhost:8500"
    scheme: "http"
    datacenter: "dc1"
    token: "${CONSUL_TOKEN}"

  etcd:
    endpoints:
      - "localhost:2379"
    username: ""
    password: ""

  kubernetes:
    namespace: "default"
    label_selector: "app=myservice"
    in_cluster: true

  memory:
    # In-memory registry exposes REST API for registration
    api_enabled: true
    api_port: 8082

# Authentication configuration
authentication:
  api_key:
    enabled: true
    header: "X-API-Key"
    keys:
      - key: "abc123"
        client_id: "client-1"
        name: "Test Client 1"
      - key: "xyz789"
        client_id: "client-2"
        name: "Test Client 2"

  jwt:
    enabled: true
    secret: "${JWT_SECRET}"
    issuer: "https://auth.example.com"
    algorithm: "HS256"

# Route definitions
routes:
  - id: "users-api"
    path: "/api/v1/users"
    path_prefix: true
    # Option 1: Static backends (used when service discovery is not available)
    backends:
      - url: "http://localhost:9001"
        weight: 1
    # Option 2: Service discovery (takes precedence if service name is set)
    # service:
    #   name: "users-service"
    #   tags: ["production"]
    auth:
      required: true
      methods: ["jwt", "api_key"]
    rate_limit:
      enabled: true
      rate: 100
      period: 1m
      burst: 10
      per_ip: false
    transform:
      request:
        headers:
          add:
            X-Request-ID: "$request_id"
            X-Forwarded-For: "$remote_addr"
            X-Forwarded-Proto: "$scheme"
            X-Forwarded-Host: "$host"
            X-Original-URI: "$request_uri"
            X-Auth-Client: "$auth_client_id"
          remove:
            - "X-Internal-Secret"
      response:
        headers:
          add:
            X-Request-ID: "$request_id"
            X-Response-Time: "$response_time ms"
    timeout: 30s
    retries: 2

  - id: "orders-api"
    path: "/api/v1/orders"
    path_prefix: true
    backends:
      - url: "http://localhost:9002"
    auth:
      required: true
      methods: ["jwt"]
    rate_limit:
      rate: 50
      period: 1m
    transform:
      request:
        headers:
          add:
            X-Request-ID: "$request_id"
    timeout: 60s

  - id: "public-api"
    path: "/api/public"
    path_prefix: true
    backends:
      - url: "http://localhost:9003"
    auth:
      required: false
    rate_limit:
      rate: 200
      period: 1m
      per_ip: true

  - id: "health"
    path: "/health"
    path_prefix: false
    backends:
      - url: "http://localhost:9001"
    auth:
      required: false

# Logging configuration
logging:
  format: '$remote_addr - [$time_iso8601] "$request_method $request_uri" $status $body_bytes_sent "$http_user_agent" $response_time'
  level: "info"
  output: "stdout"

# Admin API configuration
admin:
  enabled: true
  port: 8081
